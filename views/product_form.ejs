<%- include('partials/header', { title: (product ? 'Edit Product' : 'New Product') }) %>

<h1 class="h4 mb-3"><%= product ? 'Edit Product' : 'New Product' %></h1>

<form method="post" action="<%= product ? ('/products/' + product.id) : '/products' %>">
  <div class="row g-3">
    <div class="col-12">
      <label class="form-label" for="name">Name</label>
      <input class="form-control" id="name" name="name" required value="<%= product ? product.name : '' %>" />
    </div>
    <div class="col-12">
      <label class="form-label" for="desc">Description</label>
      <textarea class="form-control" id="desc" name="desc" rows="4" required><%= product ? product.desc : '' %></textarea>
    </div>

    <div class="mb-3">
  <label class="form-label">Category</label>
  <input 
    type="text" 
    name="category" 
    class="form-control"
    value="<%= product ? product.category : '' %>" 
    required
  >
</div>



    
    <div class="col-6 col-sm-4">
      <label class="form-label" for="price">Price</label>
      <input class="form-control" id="price" name="price" type="number" min="0" step="0.01" required value="<%= product ? product.price : '' %>" />
    </div>
    <div class="col-12">
      <label class="form-label" for="pic">Picture URL or path</label>
      <!-- Text field for the image URL. Default is /img/pic.png -->
      <input class="form-control" id="pic" name="pic" placeholder="/img/pic.png or https://..." value="<%= product ? product.pic : '/img/pic.png' %>" />
      <div class="form-text">Stored as address in DB. Use absolute URL or app-relative path.</div>
      <!-- Image preview for admin convenience -->
      <div class="d-flex align-items-center gap-3 mt-2">
        <img id="picPreview" src="<%= product ? product.pic : '/img/pic.png' %>" width="80" height="80" class="rounded object-fit-cover border" alt="pic" />
        <span class="text-muted small">Preview</span>
      </div>
    </div>
  </div>
  <div class="mt-3 d-flex gap-2">
    <button class="btn btn-primary" type="submit">Save</button>
    <a class="btn btn-outline-secondary" href="/">Cancel</a>
  </div>
</form>
<script>
  // Update the preview when entering the image URL
  const picInput = document.getElementById('pic');
  const picPreview = document.getElementById('picPreview');
  if (picInput && picPreview) {
    picInput.addEventListener('input', () => {
      const v = picInput.value && picInput.value.trim() ? picInput.value.trim() : '/img/pic.png';
      picPreview.src = v;
    });
  }
</script>
<%- include('partials/footer') %>
